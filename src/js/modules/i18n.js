const translations = {
    pt: {
        title: "Super Calculadora",
        calc: "Calculadora",
        currency: "Moedas",
        interest: "Juros",
        units: "Unidades",
        financing: "Financiar",
        dates: "Datas",
        tools: "Ãšteis",
        scientific_mode: "Modo CientÃ­fico",
        currency_converter: "Conversor de Moedas",
        amount_label: "Valor para converter",
        from_label: "De",
        to_label: "Para",
        share_title: "Compartilhar SimulaÃ§Ã£o",
        copy_link: "Copiar Link",
        calculate: "Calcular",
        simulate: "Simular",
        days: "dias",
        diff: "DiferenÃ§a",
        result_date: "Nova Data",
        total_interest: "Total de Juros",
        total_cost: "Custo Total",
        first_parcel: "Primeira Parcela",
        last_parcel: "Ãšltima Parcela",
        initial_value: "Valor Inicial",
        monthly_contribution: "Aporte Mensal",
        interest_rate: "Taxa de Juros",
        period: "PerÃ­odo",
        net_worth: "PatrimÃ´nio Final",
        invested_total: "Total Investido",
        interest_earned: "Juros Ganhos",
        total_return: "Rentabilidade",
        results_title: "Resultados",
        history: "HistÃ³rico",
        interest_type: "Tipo de Juros",
        initial_value_label: "Capital Inicial",
        monthly_contribution_label: "Aporte Mensal",
        interest_rate_label: "Taxa de Juros",
        period_label: "PerÃ­odo",
        exchange_rate: "Taxa de cÃ¢mbio",
        property_value: "Valor do Bem",
        down_payment: "Entrada",
        financing_summary: "Resumo do Financiamento",
        export_csv: "Exportar para CSV",
        add_subtract: "Adicionar/Subtrair",
        discount: "Desconto",
        tip_split: "Gorjeta / DivisÃ£o",
        footer_proof: "Prova de conceito por IA",
        length: "ðŸ“ Comprimento",
        mass: "âš–ï¸ Peso / Massa",
        temperature: "ðŸŒ¡ï¸ Temperatura",
        area: "ðŸ“ Ãrea",
        volume: "ðŸ§ª Volume",
        field: "Campo",
        value: "Valor",
        fixed_parcel: "Parcela Fixa",
        fill_correctly: "Por favor, preencha corretamente.",
        calc_interest_done: "CÃ¡lculo de juros concluÃ­do",
        investment_summary: "Resumo do Investimento"
    },
    en: {
        title: "Super Calculator",
        calc: "Calculator",
        currency: "Currency",
        interest: "Interest",
        units: "Units",
        financing: "Finance",
        dates: "Dates",
        tools: "Tools",
        scientific_mode: "Scientific Mode",
        currency_converter: "Currency Converter",
        amount_label: "Amount to convert",
        from_label: "From",
        to_label: "To",
        share_title: "Share Simulation",
        copy_link: "Copy Link",
        calculate: "Calculate",
        simulate: "Simulate",
        days: "days",
        diff: "Difference",
        result_date: "New Date",
        total_interest: "Total Interest",
        total_cost: "Total Cost",
        first_parcel: "First Payment",
        last_parcel: "Last Payment",
        initial_value: "Initial Amount",
        monthly_contribution: "Monthly Contribution",
        interest_rate: "Interest Rate",
        period: "Period",
        net_worth: "Final Net Worth",
        invested_total: "Total Invested",
        interest_earned: "Interest Earned",
        total_return: "Yield",
        results_title: "Results",
        history: "History",
        interest_type: "Interest Type",
        initial_value_label: "Initial Capital",
        monthly_contribution_label: "Monthly Contribution",
        interest_rate_label: "Interest Rate",
        period_label: "Period",
        exchange_rate: "Exchange rate",
        property_value: "Property Value",
        down_payment: "Down Payment",
        financing_summary: "Financing Summary",
        export_csv: "Export to CSV",
        add_subtract: "Add/Subtract",
        discount: "Discount",
        tip_split: "Tip / Split",
        footer_proof: "Proof of concept by AI",
        length: "ðŸ“ Length",
        mass: "âš–ï¸ Mass",
        temperature: "ðŸŒ¡ï¸ Temperature",
        area: "ðŸ“ Area",
        volume: "ðŸ§ª Volume",
        field: "Field",
        value: "Value",
        fixed_parcel: "Fixed Payment",
        fill_correctly: "Please fill correctly.",
        calc_interest_done: "Interest calculation completed",
        investment_summary: "Investment Summary"
    },
    es: {
        title: "SÃºper Calculadora",
        calc: "Calculadora",
        currency: "Monedas",
        interest: "InterÃ©s",
        units: "Unidades",
        financing: "Financiar",
        dates: "Fechas",
        tools: "Ãštiles",
        scientific_mode: "Modo CientÃ­fico",
        currency_converter: "Conversor de Monedas",
        amount_label: "Cantidad a convertir",
        from_label: "De",
        to_label: "Para",
        share_title: "Compartir SimulaciÃ³n",
        copy_link: "Copiar Enlace",
        calculate: "Calcular",
        simulate: "Simular",
        days: "dÃ­as",
        diff: "Diferencia",
        result_date: "Nueva Fecha",
        total_interest: "Total InterÃ©s",
        total_cost: "Costo Total",
        first_parcel: "Primer Pago",
        last_parcel: "Ãšltimo Pago",
        initial_value: "Monto Inicial",
        monthly_contribution: "Aporte Mensual",
        interest_rate: "Tasa de InterÃ©s",
        period: "Periodo",
        net_worth: "Patrimonio Final",
        invested_total: "Total Invertido",
        interest_earned: "InterÃ©s Ganado",
        total_return: "Rentabilidad",
        results_title: "Resultados",
        history: "Historial",
        interest_type: "Tipo de InterÃ©s",
        initial_value_label: "Capital Inicial",
        monthly_contribution_label: "Aporte Mensual",
        interest_rate_label: "Tasa de InterÃ©s",
        period_label: "Periodo",
        exchange_rate: "Tipo de cambio",
        property_value: "Valor del Bien",
        down_payment: "Enganche",
        financing_summary: "Resumen de FinanciaciÃ³n",
        export_csv: "Exportar a CSV",
        add_subtract: "Sumar/Restar",
        discount: "Descuento",
        tip_split: "Propina / DivisiÃ³n",
        footer_proof: "Prueba de concepto por IA",
        length: "ðŸ“ Longitud",
        mass: "âš–ï¸ Masa",
        temperature: "ðŸŒ¡ï¸ Temperatura",
        area: "ðŸ“ Ãrea",
        volume: "ðŸ§ª Volumen",
        field: "Campo",
        value: "Valor",
        fixed_parcel: "Cuota Fija",
        fill_correctly: "Por favor, complete correctamente.",
        calc_interest_done: "CÃ¡lculo de intereses completado",
        investment_summary: "Resumen de InversiÃ³n"
    }
};

let currentLang = localStorage.getItem('app-lang') || 'pt';

export function initI18n() {
    applyTranslations();

    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const lang = btn.dataset.lang;
            setLanguage(lang);
        });
    });
}

function setLanguage(lang) {
    currentLang = lang;
    localStorage.setItem('app-lang', lang);
    applyTranslations();

    // Atualiza botÃµes
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.lang === lang);
    });
}

export function applyTranslations() {
    const t = translations[currentLang];

    // Busca todos os elementos com data-i18n
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.dataset.i18n;
        if (t[key]) {
            // Se tiver span interno de Ã­cone, preservamos o span e traduzimos o texto se ele existir em um sub-elemento .nav-text
            const navText = el.querySelector('.nav-text');
            if (navText) {
                navText.textContent = t[key];
            } else {
                el.textContent = t[key];
            }
        }
    });

    // Casos especiais (placeholders, titles)
    const shareBtn = document.getElementById('global-share-btn');
    if (shareBtn) shareBtn.title = t.share_title;
}

export function getTranslation(key) {
    if (!translations[currentLang]) return key;
    return translations[currentLang][key] || key;
}
